"""Mempool.space data provider."""
from extraction.base import BlockchainProvider
from api_client import get_api_data


class MempoolProvider(BlockchainProvider):
    """Fetches block and transaction data from mempool.space/api."""

    BASE_URL = "https://mempool.space/api"

    @property
    def name(self) -> str:
        return "mempool"

    def get_latest_blocks(self, count: int = 10) -> list[dict]:
        """Fetch latest blocks from mempool.space.

        mempool.space returns blocks in the same schema as Blockstream,
        so no field remapping is needed.
        """
        blocks = get_api_data(f"{self.BASE_URL}/blocks")
        if not blocks:
            return []
        return blocks[:count]

    def get_block_transactions(self, block_hash: str, start_index: int = 0) -> list[dict] | None:
        """Fetch a batch of 25 transactions starting at start_index."""
        url = f"{self.BASE_URL}/block/{block_hash}/txs/{start_index}"
        return get_api_data(url)
